options ls=80;
Data CFdata;
input Number SalesID X Y Price LnPrice Year TimeYear LivingArea NMLivArea Baths CedarHts TestScore 
MedAge MedRent MedIncome PovRate InvDistUNI InvDistRoad InvDistHS InvDistRiver;
cards;
0	9396	5203631	3653685	152000	11.9316358	2013	2.13699	1181	174	1	0	659.5	22.2	641	18313	0.57	0.000409907	0.000373625	0.00021419	0.000172922
1	10037	5203810	3655276	127500	11.75587164	2012	1.92603	1001	0	1	0	659.5	29	441	48295	0.09	0.000277393	0.000398406	0.000283608	0.000201979
2	10101	5202814	3655002	183350	12.11915217	2012	1.91781	1237	1237	1	0	659.5	22.2	641	18313	0.57	0.000355114	0.000287522	0.000320616	0.00016714
3	10256	5202146	3654974	129950	11.77490504	2012	1.89863	960	0	1	0	659.5	22.2	641	18313	0.57	0.000393082	0.000241313	0.000348432	0.000154321
4	10431	5203844	3652475	125000	11.73606902	2012	1.86850	672	672	1	1	618.5	21.8	1014	19886	0.67	0.000424629	0.000461042	0.000171409	0.000157754
5	10601	5204169	3654660	124000	11.72803685	2012	1.82740	952	238	1	1	618.5	26	752	51023	0.18	0.00029146	0.000473934	0.000237248	0.000206569
6	10667	5203823	3654506	105000	11.56171563	2012	1.81644	672	488	1	1	618.5	22.2	641	18313	0.57	0.000326158	0.000407166	0.000243784	0.000191608
7	10723	5202605	3656526	188500	12.14685329	2012	1.80822	1264	0	2	0	659.5	29	441	48295	0.09	0.000240269	0.00025413	0.000557414	0.000205719
8	10815	5204187	3652940	223900	12.3189548	2012	1.79178	728	1665	2	1	618.5	26	752	51023	0.18	0.000366166	0.000509944	0.000178763	0.00017313
9	10872	5203261	3655542	137000	11.82773621	2012	1.77535	784	641	1	0	659.5	29	441	48295	0.09	0.000285225	0.000323729	0.000338868	0.000184775
10	10969	5199777	3655575	169500	12.04060821	2012	1.76713	1397	0	1	0	659.5	22.4	815	43512	0.43	0.000285307	0.000192901	0.000386847	0.000143184
11	10994	5205060	3656340	129500	11.77143616	2012	1.75617	728	824	1	0	659.5	33	481	56354	0.16	0.000191168	0.000631712	0.000247158	0.000285633
12	11024	5199939	3654867	116000	11.66134547	2012	1.75343	1044	0	1	0	659.5	22.4	815	43512	0.43	0.000355114	0.000169837	0.000320308	0.00013369
13	11036	5200513	3655946	200000	12.20607265	2012	1.75343	1682	0	1	0	659.5	41.3	693	75577	0.09	0.000280426	0.000207943	0.000525486	0.000159719
14	11155	5202930	3655003	189000	12.14950229	2012	1.73699	956	335	1	0	659.5	22.2	641	18313	0.57	0.000347947	0.000297442	0.000314663	0.0001703
15	11378	5203287	3653526	130000	11.77528973	2012	1.69863	960	960	2	0	659.5	22.2	641	18313	0.57	0.000484966	0.000335571	0.000215285	0.000162364
16	11382	5204159	3655684	156000	11.95761129	2012	1.69863	960	0	1	0	659.5	33	481	56354	0.16	0.000241429	0.00044964	0.000282486	0.000221976
17	11417	5199648	3656605	156740	11.96234366	2012	1.69589	792	792	1	0	659.5	22.4	815	43512	0.43	0.000223015	0.000240211	0.000515464	0.000160051
18	11462	5203454	3656012	117500	11.67419361	2012	1.68767	760	266	1	0	659.5	29	441	48295	0.09	0.000249377	0.000335345	0.000360101	0.000194704
19	11657	5204310	3654756	122000	11.71177632	2012	1.64110	952	428	1	1	618.5	26	752	51023	0.18	0.000277701	0.000507099	0.00023546	0.000214041
20	11740	5203947	3656144	87000	11.3736634	2012	1.62192	840	748	1	0	659.5	29	441	48295	0.09	0.000228206	0.000393701	0.000321027	0.000215983
21	11832	5199789	3655538	175000	12.07254125	2012	1.60000	1446	0	1	0	659.5	22.4	815	43512	0.43	0.000288434	0.000191534	0.000383289	0.000142735
22	11892	5200504	3656597	204400	12.22783414	2012	1.58357	1444	0	1	0	659.5	41.3	693	75577	0.09	0.000238209	0.0002405	0.000751315	0.00017452
23	12055	5204677	3654502	119000	11.68687877	2012	1.56165	681	587	1	1	618.5	26	752	51023	0.18	0.000266312	0.00062383	0.000213311	0.000223964
24	12220	5203101	3655164	189900	12.1542529	2012	1.53425	780	948	2	0	659.5	29	441	48295	0.09	0.000322685	0.000312013	0.00031837	0.000176616
25	12302	5199978	3654887	112500	11.6307085	2012	1.51507	1044	0	1	0	637.3	22.4	815	43512	0.43	0.000355745	0.000170445	0.000323939	0.000134373
26	12324	5204889	3653805	128000	11.75978554	2012	1.50959	616	1180	1	1	645.6	26	752	51023	0.18	0.000275028	0.00069735	0.000187582	0.000213402
27	12436	5200232	3656128	171420	12.05187196	2012	1.49863	1424	64	2	0	637.3	41.3	693	75577	0.09	0.000261506	0.00021617	0.000533903	0.000159515
28	12451	5204184	3654551	89700	11.40422605	2012	1.49863	1204	0	1	1	645.6	26	752	51023	0.18	0.000296209	0.000477327	0.000232288	0.000205128
29	12486	5202806	3655669	174500	12.06968002	2012	1.48767	993	0	1	0	637.3	29	441	48295	0.09	0.00029274	0.000281136	0.000390778	0.000177023
30	12559	5203608	3654892	170000	12.04355372	2012	1.46850	984	689	1	0	637.3	22.2	641	18313	0.57	0.000314169	0.000373274	0.000272628	0.000189861
31	12615	5199555	3654923	122000	11.71177632	2012	1.46302	940	0	1	0	637.3	22.4	815	43512	0.43	0.000323939	0.000170999	0.000307409	0.000130822
32	12819	5204663	3655689	115000	11.65268741	2012	1.43836	520	856	1	0	637.3	33	481	56354	0.16	0.000222866	0.000577701	0.000252398	0.000249004
33	13063	5204330	3653404	163000	12.00150548	2012	1.40000	672	1008	2	1	645.6	26	752	51023	0.18	0.000336022	0.000511771	0.000189143	0.000186116
34	13448	5204543	3653275	127500	11.75587164	2012	1.35069	780	546	1	1	645.6	26	752	51023	0.18	0.000317864	0.000584454	0.000181258	0.000189107
35	13455	5201817	3654852	114000	11.64395373	2012	1.34795	672	470	1	0	637.3	41.3	693	75577	0.09	0.000424088	0.000223864	0.000344234	0.000149432
36	13461	5202471	3654839	130000	11.77528973	2012	1.34795	1084	488	1	0	637.3	22.2	641	18313	0.57	0.000396668	0.000262261	0.00032144	0.000157257
37	13509	5199935	3655574	181500	12.10901093	2012	1.33425	1376	0	1	0	637.3	22.4	815	43512	0.43	0.000291545	0.000193013	0.0004	0.000145096
38	13607	5204876	3655559	139500	11.84581988	2012	1.31233	632	858	1	0	637.3	33	481	56354	0.16	0.000219684	0.000668449	0.000237417	0.000259808
39	13728	5204906	3653146	186500	12.13618652	2012	1.29589	770	770	1	1	645.6	26	752	51023	0.18	0.000287853	0.000754148	0.000171204	0.00019604
40	13793	5205228	3655622	115000	11.65268741	2012	1.27946	880	0	1	0	637.3	33	481	56354	0.16	0.000205761	0.000856898	0.000222767	0.000286123
41	13904	5203105	3656135	137000	11.82773621	2012	1.26576	900	0	1	0	637.3	29	441	48295	0.09	0.000252334	0.000298418	0.000411862	0.000194856
42	13958	5199729	3655976	150000	11.91839057	2012	1.25754	1120	0	1	0	637.3	22.4	815	43512	0.43	0.000257599	0.000208943	0.000434972	0.000149477
43	13991	5204998	3656010	72000	11.1844214	2012	1.25480	560	48	1	0	637.3	33	481	56354	0.16	0.000201979	0.000665336	0.000243191	0.000276625
44	14023	5202986	3651199	138500	11.83862561	2012	1.24932	832	458	1	0	648.8	21.8	1014	19886	0.67	0.000501505	0.000430663	0.000148611	0.000127649
45	14250	5203136	3654593	158750	11.97508592	2012	1.21096	1120	784	2	0	637.3	22.2	641	18313	0.57	0.000377359	0.000318167	0.000275103	0.000171969
46	14361	5204183	3653134	182900	12.11669483	2012	1.17535	748	862	1	0	647.6	26	752	51023	0.18	0.000361925	0.000497018	0.00018423	0.000176803
47	14602	5204173	3654129	179900	12.10015642	2012	1.12055	956	430	1	0	647.6	26	752	51023	0.18	0.000319387	0.00047081	0.000216638	0.000196502
48	14684	5203102	3656492	128000	11.75978554	2012	1.10411	900	0	1	0	647.6	29	441	48295	0.09	0.0002331	0.000289771	0.00045208	0.000209118
49	14714	5200513	3656151	189000	12.14950229	2012	1.09589	1332	0	1	0	647.6	41.3	693	75577	0.09	0.000265745	0.000217202	0.00058309	0.000164204
50	14798	5204312	3654553	125000	11.73606902	2012	1.07672	672	461	1	0	647.6	26	752	51023	0.18	0.000287274	0.000508388	0.000227687	0.00021004
51	14970	5202914	3656198	95000	11.46163217	2012	1.02466	720	0	1	0	647.6	29	441	48295	0.09	0.000253357	0.000281611	0.000445832	0.000195733
52	15043	5203596	3656471	87750	11.38224714	2012	1.00822	480	712	1	0	647.6	29	441	48295	0.09	0.000223214	0.000335796	0.000377501	0.00021263
53	15080	5204332	3653206	130000	11.77528973	2012	1.00000	900	98	1	0	647.6	26	752	51023	0.18	0.00034188	0.000529942	0.000183486	0.000181984
;


data cfdata2;
set cfdata;
if Number=0 then delete;
LnPrice2 = LnPrice;

data cfdata3;
set cfdata;
if Number=0;
Comp=Number;


data cfdata4;
set cfdata3 cfdata2;

proc reg data=cfdata4;
  model LnPrice2 = TimeYear LivingArea NMLivArea Baths CedarHts TestScore 
                   MedAge MedRent MedIncome PovRate InvDistUNI InvDistRoad 
                   InvDistHS InvDistRiver X;
output out=next r=resid p=yhat LCL=lowerP LCLM=lowerM UCL=upperP UCLM=upperM PRESS=PressResid;

proc rank normal=blom;
    var resid;
    ranks nscore;
    
proc plot;
    plot resid*nscore;
    plot resid*yhat;

proc corr;
    var resid nscore;

proc univariate normal;
   var resid;

data final;
set next;
  Predicted = exp(yhat);
  LowerCI = exp(lowerM);
  UpperCI = exp(upperM);
  LowerPI = exp(lowerP);
  UpperPI = exp(upperP);
  lnPress = lnPrice2 - PressResid;
  Press = exp(lnPress);

proc print data=final;
    *var Number SalesID Year TimeYear Price Predicted LowerCI UpperCI LowerPI UpperPI; 
     var Number SalesID Year TimeYear Price Predicted Press;
run;


